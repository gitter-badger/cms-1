"use strict";angular.module("cmsApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ui.bootstrap","mgcrea.ngStrap.datepicker","mgcrea.ngStrap.tooltip","mgcrea.ngStrap.helpers.dateParser","mgcrea.ngStrap.timepicker"]).config(["$routeProvider",function(a){a.when("/auth",{templateUrl:"views/auth.html",controller:"AuthCtrl"}).when("/post/search",{templateUrl:"views/post/search.html",controller:"PostSearchCtrl"}).when("/post",{templateUrl:"views/post/create.html",controller:"PostCreateCtrl"}).otherwise({redirectTo:"/auth"})}]).filter("startFrom",function(){return function(a,b){return a.slice(b)}}),angular.module("cmsApp").controller("AuthCtrl",["$rootScope","$scope","$timeout","$location","oauth","User","Repository",function(a,b,c,d,e,f,g){b.finish=function(c){c&&(b.user.repository=c,a.user=b.user,d.path("/post/search"))},b.getRepositories=function(a){a?(b.user.repositories=g.organization.get(a).repositories(),b.user.organization=angular.fromJson(a)):(b.user.organization=void 0,b.user.repositories=[])},b.authenticate=function(){c(function(){b.user=f.info()},0)}}]),angular.module("cmsApp").factory("oauth",function(){var a=window.OAuth;return a.initialize("gRrK6us96AdRhG6vAGfQtbdUnY4"),a}),angular.module("cmsApp").factory("User",["_","Github",function(a,b){return{info:function(){var c=a.map(b.organization.list(),function(a){return b.organization.get().org(a.id)}),d={name:"Rodrigo",organizations:c,repositories:[]};return d}}}]),angular.module("cmsApp").factory("GithubOrganization",["_",function(a){var b=[{login:"brasil-de-fato",id:8516140,avatar_url:"https://avatars.githubusercontent.com/u/8516140?v=2"},{login:"movimento-sem-terra",id:7000646,avatar_url:"https://avatars.githubusercontent.com/u/7000646?v=2"}],c=[{id:17912445,name:"site-novo",full_name:"movimento-sem-terra/site-novo"},{id:17912445,name:"tabloides",full_name:"movimento-sem-terra/site-novo"}],d=[{id:7000646,login:"movimento-sem-terra",name:"Movimento dos Trabalhadores Rurais Sem Terra",avatar_url:"https://avatars.githubusercontent.com/u/7000646?v=2"},{id:8516140,login:"brasil-de-fato",name:"Brasil de Fato",avatar_url:"https://avatars.githubusercontent.com/u/8516140?v=2"}];return{list:function(){return b},get:function(){return{repositories:function(){return c},org:function(b){return a.find(d,function(a){return a.id===b})}}}}}]),angular.module("cmsApp").factory("_",function(){return window._}),angular.module("cmsApp").controller("PostSearchCtrl",["$scope","DateUtil","Repository",function(a,b,c){a.posts=c.post.list(),a.maxSize=5,a.currentPage=1,a.filter={month:b.now.getMonth(),year:b.now.getYear()}}]),angular.module("cmsApp").service("DateUtil",function(){this.now={getMonth:function(){return(new Date).getMonth()},getYear:function(){return(new Date).getFullYear()}}}),angular.module("cmsApp").factory("YoutubeLinkUtil",function(){function a(a){return a?c.exec(a)[1]:""}function b(b){return b?'<p style="text-align: center;"><iframe allowfullscreen="" name="coverVideo" frameborder="0" height="360" src="//www.youtube.com/embed/'+a(b)+'" width="640"></iframe></p>':""}var c=/(?:youtube\.(?:com|com\.br)\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/ ]{11})/,d={pattern:function(){return c},link:function(c){return{getId:function(){return a(c)},getEmbed:function(){return b(c)}}}};return d}),angular.module("cmsApp").factory("Repository",["Github",function(a){var b={list:function(){return a.content.posts()}};return{post:b,organization:a.organization}}]),angular.module("cmsApp").factory("GithubContent",function(){return{posts:function(){return[{sha:"#1",name:"Na Amazônia, Sem Terra enfrentam o grupo de Dantas",year:2014,month:10},{sha:"#2",name:"Ocupação em Goiás é batizada com o nome de Dom Tomás Balduíno",year:2014,month:10},{sha:"#3",name:"Onde está a Reforma Agrária no debate eleitoral?",year:2014,month:10},{sha:"#4",name:"JBS expõe trabalhadores ao frio e sofre a quarta condenação este ano",year:2014,month:10},{sha:"#5",name:"Três mil famílias do MST ocupam a fazenda Santa Mônica, do senador Eunício Oliveira",year:2014,month:10},{sha:"#6",name:"As grandes questões ausentes no debate eleitoral",year:2014,month:10},{sha:"#7",name:"Organizações fazem ajustes finais para plebiscito da reforma política",year:2014,month:10},{sha:"#8",name:"Dez empresas são donas de 73% das sementes de todo o mundo",year:2014,month:10}]}}}),angular.module("cmsApp").factory("Github",["GithubOrganization","GithubContent",function(a,b){return{organization:a,content:b}}]),angular.module("cmsApp").controller("PostCreateCtrl",["$scope",function(a){a.entity={video:"http://www.youtube.com/watch?v=UViv0FQJrgo",cover:"http://farm6.staticflickr.com/5552/14934144587_2c2b186d58_n.jpg",date:"2014-09-10T11:52:11-03:00"},a.fields=[{name:"date",pattern:"",icon:"fa-calendar",title:"Data da Notícia",required:!0,type:{view:"date"}},{name:"video",pattern:"",icon:"fa-youtube",title:"Youtube",required:!0,type:{view:"video"}},{name:"cover",pattern:"",icon:"fa-picture-o",title:"Imagem de Capa",required:!0,type:{view:"cover"}},{name:"country",title:"Country",type:{view:"select",options:[{id:0,name:"USA"},{id:1,name:"German"},{id:2,name:"Russia"}]}},{name:"description",title:"Description",placeholder:"Preencha isso aqui",type:{view:"textarea"}}]}]),angular.module("cmsApp").directive("youtube",["$window","YoutubeLinkUtil",function(a,b){return{restrict:"E",scope:{url:"@"},template:"<div></div>",link:function(c,d){function e(){return new YT.Player(d.children()[0],{playerVars:{autoplay:0,html5:1,theme:"light",modesbranding:0,color:"white",iv_load_policy:3,showinfo:1,controls:1},height:"350px",width:"100%",videoId:b.link(c.url).getId()})}function f(){i||a.onYouTubeIframeAPIReady()}var g=document.createElement("script");g.src="https://www.youtube.com/iframe_api";var h=document.getElementsByTagName("script")[0];h.parentNode.insertBefore(g,h);var i;a.onYouTubeIframeAPIReady=function(){i=e()},c.$watch("url",function(a,c){a&&a!==c&&(f(),i.cueVideoById&&i.cueVideoById(b.link(a).getId()))})}}}]);